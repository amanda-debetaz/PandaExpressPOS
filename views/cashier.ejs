<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cashier POS - Panda Express</title>
  </head>
  <style>
    /* ============ THEME ============ */
    :root {
      /* Light grey restaurant POS + Panda accents */
      --bg-page: #f5f6f7;
      --bg-panel: #ffffff;
      --bg-surface: #eceeef;
      --bg-surface-alt: #e2e4e7;

      --line-soft: #d1d3d6;
      --line-strong: #babdc2;

      --accent-red: #b91c1c;
      --accent-red-bright: #ef4444;
      --accent-green: #16a34a;

      --text-main: #1b1b1d;
      --text-muted: #4b5563;
      --text-soft: #6b7280;

      --shadow-soft: 0 3px 10px rgba(0, 0, 0, 0.12);

      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;

      --transition-fast: 0.15s ease-out;
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    /* ============ BASE ============ */

    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
    }

    .cashier-body {
      min-height: 100vh;
      background: var(--bg-page);
      color: var(--text-main);
      display: flex;
      flex-direction: column;
    }

    /* ============ HEADER ============ */

    .cashier-header {
      display: grid;
      grid-template-columns: minmax(0, 280px) minmax(0, 1fr) minmax(0, 320px);
      gap: 1.5rem;
      align-items: center;
      padding: 0.9rem 1.75rem;
      background: #ffffff;
      border-bottom: 1px solid var(--line-soft);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1.25rem;
    }

    .brand-lockup {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
    }

    .brand-name {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: var(--accent-red);
      font-weight: 700;
    }

    .brand-sub {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-soft);
    }

    .station-meta {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      border: 1px solid var(--line-soft);
      background: var(--bg-surface);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-soft);
    }

    .station-label {
      opacity: 0.8;
    }

    .station-value {
      font-weight: 600;
      color: var(--text-main);
    }

    /* ============ SEARCH AUTOCOMPLETE ============ */

    .header-center {
      display: flex;
      align-items: center;
    }

    .search-input {
      width: 75%;
      padding: 0.7rem 1rem;
      border-radius: 999px;
      border: 1px solid var(--line-soft);
      background: var(--bg-surface);
      font-size: 0.85rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--text-main);
      outline: none;
      transition: border-color var(--transition-fast),
        box-shadow var(--transition-fast), background var(--transition-fast);
    }

    .search-input::placeholder {
      color: var(--text-soft);
      text-align: center;
    }

    .search-input:focus {
      border-color: var(--accent-red-bright);
      background: #ffffff;
      box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.25);
    }

    .search-wrapper {
      position: relative;
      width: 100%;
    }

    .search-suggestions {
      position: absolute;
      top: 110%;
      left: 0;
      right: 0;
      background: var(--bg-panel);
      border-radius: 0.6rem;
      border: 1px solid var(--line-soft);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      max-height: 260px;
      overflow-y: auto;
      padding: 0.25rem 0;
      display: none;
      z-index: 50;
    }

    .search-suggestions.visible {
      display: block;
    }

    .search-suggestion-item {
      padding: 0.5rem 0.75rem;
      font-size: 0.85rem;
      color: var(--text-main);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .search-suggestion-item span {
      pointer-events: none;
    }

    .search-suggestion-item-kind {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--text-soft);
      margin-left: 0.75rem;
    }

    .search-suggestion-item:hover {
      background: #fef2f2;
    }

    .header-right {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 0.9rem;
    }

    .total-display {
      padding: 0.5rem 0.9rem;
      border-radius: var(--radius-md);
      border: 1px solid var(--accent-red);
      background: linear-gradient(to bottom, #ffffff, #fef2f2);
      box-shadow: 0 0 0 1px rgba(248, 113, 113, 0.3);
      min-width: 170px;
    }

    .total-label {
      display: block;
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-soft);
    }

    .total-value {
      margin-top: 0.15rem;
      font-family: "Space Mono", ui-monospace, SFMono-Regular, Menlo, Monaco,
        Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 1.6rem;
    }

    .clock-btn {
      padding: 0.55rem 1.1rem;
      border-radius: 999px;
      border: 1px solid var(--line-strong);
      background: var(--bg-surface);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: var(--text-muted);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: background var(--transition-fast),
        border-color var(--transition-fast), box-shadow var(--transition-fast),
        transform var(--transition-fast);
    }

    .clock-btn::before {
      content: "";
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent-green);
      box-shadow: 0 0 8px rgba(22, 163, 74, 0.6);
    }

    .clock-btn:hover {
      background: #ffffff;
      border-color: var(--accent-red-bright);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      transform: translateY(-1px);
    }

    /* ============ MAIN LAYOUT ============ */

    .cashier-main {
      flex: 1;
      display: grid;
      grid-template-columns: minmax(340px, 0.9fr) minmax(520px, 1.1fr);
      gap: 1.75rem;
      padding: 1.25rem 1.75rem 1rem;
      height: calc(100vh - 14rem);
      overflow: hidden;
    }

    @media (max-width: 1024px) {
      .cashier-main {
        grid-template-columns: 1fr;
      }
    }

    /* LEFT: ORDER COLUMN */

    .order-column {
      display: flex;
      flex-direction: column;
    }

    .order-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: var(--bg-panel);
      border-radius: var(--radius-lg);
      border: 1px solid var(--line-soft);
      box-shadow: var(--shadow-soft);
      overflow: hidden;
    }

    .order-panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid var(--line-soft);
      background: var(--bg-surface);
    }

    .order-info {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
    }

    .order-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-soft);
    }

    .order-number {
      font-weight: 600;
      font-size: 1rem;
    }

    .meal-status-pill {
      min-width: 260px;
      padding: 0.55rem 0.9rem;
      border-radius: 999px;
      border: 2px solid #ef4444;
      background: #fef2f2;
      color: #991b1b;

      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.12em;

      display: flex;
      align-items: center;
      justify-content: center;

      box-shadow: 0 0 10px rgba(239, 68, 68, 0.25);
    }

    .meal-status-pill:empty {
      opacity: 0;
      border-color: transparent;
      background: transparent;
      box-shadow: none;
    }

    .order-status {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      background: #ecfdf5;
      border: 1px solid #bbf7d0;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #166534;
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent-green);
    }

    .order-table-wrapper {
      flex: 1;
      overflow-y: auto;
    }

    .order-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }

    .order-header {
      background: var(--bg-surface-alt);
    }

    .order-header th {
      padding: 0.6rem 0.75rem;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-soft);
      text-align: left;
      border-bottom: 1px solid var(--line-soft);
    }

    .order-body tr {
      border-bottom: 1px solid var(--line-soft);
    }

    .order-body td {
      padding: 0.7rem 0.75rem;
      font-size: 0.9rem;
    }

    /* More space in rows for touch interaction */
    .order-body tr {
      height: 52px;
    }

    /* Column widths */
    .col-item {
      width: 55%;
    }
    .col-qty {
      width: 12%;
    }
    .col-price {
      width: 18%;
    }
    .col-delete {
      width: 15%;
    }

    .order-summary-row {
      display: flex;
      align-items: stretch;
      justify-content: space-between;
      gap: 1rem;
      padding: 0.8rem 1rem;
      border-top: 1px solid var(--line-soft);
      background: var(--bg-surface);
    }

    .summary-left {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
    }

    .summary-line {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 0.85rem;
    }

    .summary-value {
      font-variant-numeric: tabular-nums;
    }

    .summary-right {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* ============ RIGHT: MENU COLUMN ============ */

    .menu-column {
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      padding-right: 8px;
    }

    .menu-grid {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 1.1rem;
    }

    .menu-block {
      background: var(--bg-panel);
      border-radius: var(--radius-lg);
      border: 1px solid var(--line-soft);
      box-shadow: var(--shadow-soft);
      padding: 0.9rem 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }

    /* Entree block spans wide */
    .menu-block-wide {
      grid-column: 1 / -1;
    }

    @media (max-width: 1024px) {
      .menu-grid {
        grid-template-columns: 1fr;
      }
      .menu-block-wide {
        grid-column: auto;
      }
    }

    .section-title {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: var(--text-soft);
    }

    .menu-block-header {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .menu-block-subtitle {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* Button layouts: spaced for quick tapping */

    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
    }

    .button-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 0.8rem;
    }

    /* ============ BUTTONS ============ */

    .btn {
      border-radius: var(--radius-md);
      border: 1px solid var(--line-strong);
      background: var(--bg-surface);
      color: var(--text-main);
      padding: 0.9rem 1rem;
      font-size: 0.9rem;
      font-weight: 500;
      text-align: center;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      transition: background var(--transition-fast),
        border-color var(--transition-fast), box-shadow var(--transition-fast),
        transform var(--transition-fast), color var(--transition-fast);
      min-width: 130px;
    }

    /* Make press areas larger overall */
    .btn {
      line-height: 1.2;
    }

    /* Button variants */

    .btn-meal {
      background: #fef2f2;
      border-color: var(--accent-red);
    }

    .btn-meal:hover {
      background: #fee2e2;
      box-shadow: 0 2px 8px rgba(248, 113, 113, 0.35);
      transform: translateY(-1px);
    }

    .btn-base {
      background: #f3f4f6;
    }

    .btn-base:hover {
      background: #e5e7eb;
      border-color: var(--accent-red-bright);
    }

    .btn-entree {
      background: #ffffff;
      border-color: var(--line-strong);
    }

    .btn-entree:hover {
      border-color: var(--accent-red-bright);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.12);
      transform: translateY(-1px);
    }

    .btn-app {
      background: #fefce8;
      border-color: #facc15;
    }

    .btn-app:hover {
      background: #fef9c3;
    }

    .btn-drink {
      background: #dbeafe;
      border-color: #93c5fd;
      color: #1e3a8a;
    }

    .btn-drink:hover {
      background: #bfdbfe;
      border-color: #60a5fa;
    }

    /* Secondary / utility buttons */

    .btn-secondary {
      background: #f3f4f6;
      border-color: var(--line-soft);
      font-size: 0.8rem;
      padding-inline: 0.9rem;
    }

    .btn-secondary:hover {
      background: #e5e7eb;
      border-color: var(--accent-red);
    }

    .btn-void {
      background: #f3f4f6;
      border: 0.1rem solid var(--line-soft);
      padding: 0.35rem 0.6rem;
      font-size: 0.7rem;
      line-height: 1;
      border-radius: 0.6rem;
      cursor: pointer;

      min-width: 0;
      width: auto;
      display: inline-flex;
      align-items: center;
      justify-content: center;

      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .btn-void:hover {
      border-color: var(--accent-red-bright);
      background: #fee2e2;
    }

    /* Footer button styles */

    .btn-outline {
      background: transparent;
      border-color: var(--line-strong);
      font-size: 0.8rem;
    }

    .btn-outline:hover {
      background: #f3f4f6;
      border-color: var(--accent-red);
    }

    .btn-outline-danger {
      background: transparent;
      border-color: var(--accent-red);
      color: var(--accent-red);
      font-size: 0.8rem;
    }

    .btn-outline-danger:hover {
      background: #fee2e2;
    }

    .btn-pay {
      padding: 0.95rem 3.5rem;
      background: var(--accent-red);
      border-color: var(--accent-red-bright);
      color: #ffffff;
      font-size: 0.95rem;
      font-weight: 600;
      box-shadow: 0 0 20px rgba(248, 113, 113, 0.5);
    }

    .btn-pay:hover {
      background: #991b1b;
      border-color: var(--accent-red-bright);
    }

    /* Selected state for meal-building */
    .btn-selected {
      background: #fee2e2;
      border-color: var(--accent-red-bright);
      box-shadow: 0 0 0 2px rgba(248, 113, 113, 0.35);
      transform: translateY(-1px);
    }

    /* ============ FOOTER ============ */

    .cashier-footer {
      padding: 0.75rem 1.75rem 1rem;
      border-top: 1px solid var(--line-soft);
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .footer-left,
    .footer-center,
    .footer-right {
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }

    @media (max-width: 768px) {
      .cashier-footer {
        flex-direction: column;
        align-items: stretch;
      }

      .footer-center {
        justify-content: center;
      }
    }

    /* ============ DRINK SIZE POPUP ============ */

    .drink-popup-overlay {
      position: fixed;
      inset: 0;
      display: none; /* JS sets to flex when open */
      align-items: center;
      justify-content: center;
      background: rgba(15, 23, 42, 0.45); /* soft dark overlay */
      backdrop-filter: blur(4px);
      z-index: 9990;
    }

    .drink-popup-modal {
      background: var(--bg-panel);
      border-radius: 1rem;
      padding: 1.4rem 1.6rem 1.2rem;
      width: 320px;
      max-width: 90vw;
      box-shadow: 0 18px 35px rgba(0, 0, 0, 0.28);
      border: 1px solid var(--line-soft);
      display: flex;
      flex-direction: column;
      gap: 0.9rem;
    }

    .drink-popup-title {
      margin: 0;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: var(--text-soft);
      text-align: center;
    }

    .drink-size-options {
      display: flex;
      flex-direction: column;
      gap: 0.55rem;
      margin-top: 0.2rem;
    }

    /* Use existing .btn styling but tweak for this modal */
    .drink-size-option {
      width: 100%;
      justify-content: center;
      background: var(--bg-surface);
      border-color: var(--line-soft);
      font-size: 0.9rem;
      letter-spacing: 0.12em;
    }

    .drink-size-option:hover {
      background: #fef2f2;
      border-color: var(--accent-red-bright);
      box-shadow: 0 1px 6px rgba(248, 113, 113, 0.45);
      transform: translateY(-1px);
    }

    .drink-size-cancel {
      margin-top: 0.2rem;
      align-self: center;
      background: transparent;
      border: none;
      color: var(--text-soft);
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      cursor: pointer;
      padding: 0.4rem 0.6rem;
    }

    .drink-size-cancel:hover {
      color: var(--accent-red);
    }
  </style>

  <body class="cashier-body">
    <!-- Top bar -->
    <header class="cashier-header">
      <div class="header-left">
        <div class="brand-lockup">
          <div class="brand-name">Panda Express</div>
          <div class="brand-sub">Cashier Station</div>
        </div>
      </div>

      <div class="header-center">
        <div class="search-wrapper">
          <input type="text" class="search-input" placeholder="Search item" />
          <div class="search-suggestions" id="search-suggestions"></div>
        </div>
      </div>

      <div class="header-right">
        <div class="total-display">
          <span class="total-label">Order Total</span>
          <span class="total-value">$0.00</span>
        </div>
        <button class="clock-btn" id="clock-toggle-btn">Clock In/Out</button>
        <div class="station-meta" id="clock-status" style="display: none">
          <span class="station-label">Clocked:</span>
          <span class="station-value" id="clocked-employee-name">-</span>
        </div>
      </div>
    </header>

    <!-- Main content -->
    <main class="cashier-main">
      <!-- LEFT: Order detail -->
      <section class="order-column">
        <div class="order-panel">
          <div class="order-panel-header">
            <div class="order-info">
              <div class="order-label">Order #</div>
              <div class="order-number" id="order-number">1</div>
            </div>
            <div class="meal-status-pill" id="meal-status"></div>
            <div class="order-status">
              <span class="status-dot"></span>
              <span class="status-text">In Progress</span>
            </div>
          </div>

          <div class="order-table-wrapper">
            <table class="order-table">
              <thead class="order-header">
                <tr>
                  <th class="col-item">Item</th>
                  <th class="col-qty">Qty</th>
                  <th class="col-price">Price</th>
                  <th class="col-delete">Void</th>
                </tr>
              </thead>
              <tbody class="order-body" id="order-body">
                <!-- dynamic order rows go here -->
              </tbody>
            </table>
          </div>

          <div class="order-summary-row">
            <div class="summary-left">
              <div class="summary-line">
                <span>Subtotal</span>
                <span class="summary-value" id="subtotal-value">$0.00</span>
              </div>
              <div class="summary-line">
                <span>Tax</span>
                <span class="summary-value" id="tax-value">$0.00</span>
              </div>
            </div>
            <div class="summary-right">
              <button class="btn btn-secondary" id="void-last-btn">
                Void Line
              </button>
              <button class="btn btn-secondary" id="clear-order-btn">
                Clear Order
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- RIGHT: Big button entry area -->
      <section class="menu-column">
        <div class="menu-grid">
          <!-- Meal Size -->
          <section class="menu-block">
            <h3 class="section-title">Meals</h3>
            <div class="button-row">
              <button
                class="btn btn-meal order-btn"
                data-kind="meal"
                data-name="Bowl"
                data-price="8.50"
              >
                Bowl
              </button>
              <button
                class="btn btn-meal order-btn"
                data-kind="meal"
                data-name="Plate"
                data-price="10.10"
              >
                Plate
              </button>
              <button
                class="btn btn-meal order-btn"
                data-kind="meal"
                data-name="Bigger Plate"
                data-price="11.70"
              >
                Bigger Plate
              </button>
              <button
                class="btn btn-meal order-btn"
                data-name="A La Carte"
                data-price=""
              >
                A La Carte
              </button>
            </div>
          </section>

          <!-- Base -->
          <section class="menu-block">
            <h3 class="section-title">Bases</h3>
            <div class="button-row">
              <button
                class="btn btn-base order-btn"
                data-kind="base"
                data-name="White Steamed Rice"
                data-price="5.55"
              >
                White Steamed Rice
              </button>
              <button
                class="btn btn-base order-btn"
                data-kind="base"
                data-name="Fried Rice"
                data-price="5.55"
              >
                Fried Rice
              </button>
              <button
                class="btn btn-base order-btn"
                data-kind="base"
                data-name="Chow Mein"
                data-price="5.55"
              >
                Chow Mein
              </button>
              <button
                class="btn btn-base order-btn"
                data-kind="base"
                data-name="Super Greens"
                data-price="5.55"
              >
                Super Greens
              </button>
            </div>
          </section>

          <!-- Entrees: wide block -->
          <section class="menu-block menu-block-wide">
            <h3 class="section-title">Entrees</h3>
            <div class="button-grid entree-buttons">
              <button
                class="btn btn-entree order-btn"
                data-kind="entree"
                data-name="Honey Walnut Shrimp"
                data-price="7.95"
              >
                Honey Walnut Shrimp
              </button>
              <button
                class="btn btn-entree order-btn"
                data-kind="entree"
                data-name="Black Pepper Sirloin Steak"
                data-price="7.95"
              >
                Black Pepper Sirloin Steak
              </button>

              <button
                class="btn btn-entree order-btn"
                data-kind="entree"
                data-name="Mushroom Chicken"
                data-price="6.50"
              >
                Mushroom Chicken
              </button>
              <button
                class="btn btn-entree order-btn"
                data-kind="entree"
                data-name="Kung Pao Chicken"
                data-price="6.50"
              >
                Kung Pao Chicken
              </button>
              <button
                class="btn btn-entree order-btn"
                data-kind="entree"
                data-name="String Bean Chicken Breast"
                data-price="6.50"
              >
                String Bean Chicken Breast
              </button>
              <button
                class="btn btn-entree order-btn"
                data-kind="entree"
                data-name="The Original Orange Chicken"
                data-price="6.50"
              >
                The Original Orange Chicken
              </button>
              <button
                class="btn btn-entree order-btn"
                data-kind="entree"
                data-name="Honey Sesame Chicken Breast"
                data-price="6.50"
              >
                Honey Sesame Chicken Breast
              </button>
              <button
                class="btn btn-entree order-btn"
                data-kind="entree"
                data-name="Grilled Teriyaki Chicken"
                data-price="6.50"
              >
                Grilled Teriyaki Chicken
              </button>
              <button
                class="btn btn-entree order-btn"
                data-kind="entree"
                data-name="Broccoli Beef"
                data-price="6.50"
              >
                Broccoli Beef
              </button>
              <button
                class="btn btn-entree order-btn"
                data-kind="entree"
                data-name="Beijing Beef"
                data-price="6.50"
              >
                Beijing Beef
              </button>
              <button
                class="btn btn-entree order-btn"
                data-kind="entree"
                data-name="Black Pepper Chicken"
                data-price="6.50"
              >
                Black Pepper Chicken
              </button>

              <button
                class="btn btn-entree order-btn"
                data-kind="entree"
                data-name="Super Greens (Entree)"
                data-price="6.50"
              >
                Super Greens (Entree)
              </button>
            </div>
          </section>

          <!-- Appetizers / Sides -->
          <section class="menu-block">
            <h3 class="section-title">Appetizers</h3>
            <div class="button-row">
              <button
                class="btn btn-app order-btn"
                data-kind="item"
                data-name="Chicken Egg Roll"
                data-price="2.95"
              >
                Chicken Egg Roll
              </button>
              <button
                class="btn btn-app order-btn"
                data-kind="item"
                data-name="Veggie Spring Roll"
                data-price="2.65"
              >
                Veggie Spring Roll
              </button>
              <button
                class="btn btn-app order-btn"
                data-kind="item"
                data-name="Cream Cheese Rangoon"
                data-price="2.65"
              >
                Cream Cheese Rangoon
              </button>
            </div>
          </section>

          <!-- Drinks -->
          <section class="menu-block">
            <h3 class="section-title">Drinks</h3>
            <div class="button-row drink-buttons">
              <button
                class="btn btn-drink drink-btn"
                data-base="Fountain Drink"
                data-name="Fountain Drink"
                data-price="2.20"
              >
                Fountain Drink
              </button>
            </div>
          </section>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="cashier-footer">
      <div class="footer-left">
        <button id="back-nav-btn" class="btn btn-outline">
          Back to Navigation
        </button>
      </div>

      <div class="footer-center">
        <button class="btn btn-pay">Pay</button>
      </div>

      <div class="footer-right">
        <button id="logout-btn" class="btn btn-outline-danger">Logout</button>
      </div>
    </footer>

    <!-- STAFF CALL POPUP - Clean, Professional, Touch-Friendly -->
    <div id="staff-call-popup">
      <div class="staff-call-overlay"></div>

      <div class="staff-call-modal">
        <div class="staff-call-header">
          <svg
            class="staff-call-bell"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
          >
            <path
              d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 104 0v.341C18.67 6.165 20 8.388 20 11v3.159c0 .538-.214 1.055-.595 1.436L18 17zM9 17H4l1.405-1.405A2.032 2.032 0 016 14.158V11a6.002 6.002 0 014-5.659V5a2 2 0 114 0v.341A6.002 6.002 0 0118 11v3.159c0 .538.214 1.055.595 1.436L20 17h-5m-6 0v1a3 3 0 106 0v-1m-6 0h6"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
          <h2>Customer Needs Help</h2>
        </div>

        <p class="staff-call-text">
          A customer at the <strong>KIOSK</strong> is requesting assistance
        </p>

        <button id="staff-call-dismiss" class="staff-call-btn">Dismiss</button>
      </div>
    </div>

    <style>
      #staff-call-popup {
        position: fixed;
        inset: 0;
        z-index: 9999;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(6px);
        display: none;
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.4s ease-out;
      }

      #staff-call-popup.active {
        display: flex;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .staff-call-overlay {
        position: absolute;
        inset: 0;
      }

      .staff-call-modal {
        background: white;
        border-radius: 1.5rem;
        padding: 2.5rem 2rem 2rem;
        width: 90%;
        max-width: 420px;
        text-align: center;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        animation: slideUp 0.5s ease-out;
        border: 4px solid #ef4444;
      }

      @keyframes slideUp {
        from {
          transform: translateY(50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
      .staff-call-modal {
        position: relative;
        z-index: 10;
      }

      .staff-call-header {
        margin-bottom: 1.2rem;
      }

      .staff-call-bell {
        width: 80px;
        height: 80px;
        color: #ef4444;
        margin-bottom: 1rem;
        animation: ring 2s infinite;
      }

      @keyframes ring {
        0%,
        100% {
          transform: rotate(0deg);
        }
        10% {
          transform: rotate(15deg);
        }
        20% {
          transform: rotate(-10deg);
        }
        30% {
          transform: rotate(15deg);
        }
        40% {
          transform: rotate(-10deg);
        }
        50% {
          transform: rotate(10deg);
        }
        60% {
          transform: rotate(0);
        }
      }

      .staff-call-modal h2 {
        font-size: 2rem;
        font-weight: 800;
        color: #1f2937;
        margin: 0;
      }

      .staff-call-text {
        font-size: 1.35rem;
        color: #4b5563;
        margin: 1rem 0 2rem;
        line-height: 1.5;
      }

      .staff-call-text strong {
        color: #dc2626;
        font-weight: 900;
      }

      .staff-call-btn {
        width: 100%;
        padding: 1.1rem;
        background: #dc2626;
        color: white;
        font-size: 1.4rem;
        font-weight: 700;
        border: none;
        border-radius: 1rem;
        cursor: pointer;
        transition: all 0.2s;
        box-shadow: 0 8px 20px rgba(220, 38, 38, 0.3);
      }

      .staff-call-btn:hover {
        background: #b91c1c;
        transform: translateY(-2px);
      }

      .staff-call-btn:active {
        transform: translateY(1px);
      }

      /* Make it extra obvious on touch devices */
      @media (max-width: 768px) {
        .staff-call-modal {
          margin: 1rem;
          padding: 3rem 2rem;
        }
        .staff-call-bell {
          width: 100px;
          height: 100px;
        }
        .staff-call-modal h2 {
          font-size: 2.3rem;
        }
        .staff-call-text {
          font-size: 1.5rem;
        }
        .staff-call-btn {
          padding: 1.4rem;
          font-size: 1.6rem;
        }
      }
    </style>

    <!-- CLOCK IN/OUT MODAL -->
    <div id="clock-modal" class="drink-popup-overlay" style="display: none">
      <div class="drink-popup-modal" style="width: 400px">
        <h3 class="drink-popup-title" id="clock-modal-title">
          Clock Management
        </h3>

        <div id="clock-in-section">
          <p
            style="
              text-align: center;
              margin-bottom: 1rem;
              color: var(--text-muted);
              font-size: 0.85rem;
            "
          >
            Enter Employee ID to Clock In
          </p>
          <input
            type="number"
            id="clock-in-employee-id"
            placeholder="Employee ID"
            style="
              width: 100%;
              padding: 0.7rem;
              border-radius: 0.5rem;
              border: 1px solid var(--line-soft);
              font-size: 0.9rem;
              margin-bottom: 1rem;
              text-align: center;
            "
          />
          <button
            class="btn drink-size-option"
            id="clock-in-btn"
            style="
              width: 100%;
              background: var(--accent-green);
              color: white;
              border-color: var(--accent-green);
            "
          >
            Clock In
          </button>
        </div>

        <div id="clock-out-section" style="display: none">
          <p
            style="
              text-align: center;
              margin-bottom: 1rem;
              color: var(--text-muted);
              font-size: 0.85rem;
            "
          >
            Currently clocked in:
            <strong id="current-clocked-employee">-</strong>
          </p>
          <button
            class="btn drink-size-option"
            id="clock-out-btn"
            style="
              width: 100%;
              background: var(--accent-red);
              color: white;
              border-color: var(--accent-red);
            "
          >
            Clock Out
          </button>
        </div>

        <button
          id="clock-modal-cancel"
          class="drink-size-cancel"
          style="margin-top: 0.5rem"
        >
          Cancel
        </button>
      </div>
    </div>

    <!-- DRINK SIZE POPUP -->
    <div id="drink-size-popup" class="drink-popup-overlay">
      <div class="drink-popup-modal">
        <h3 class="drink-popup-title">Select Drink Size</h3>

        <div class="drink-size-options">
          <button
            class="btn drink-size-btn drink-size-option"
            data-size="Small"
            data-price="2.20"
          >
            Small – $2.20
          </button>

          <button
            class="btn drink-size-btn drink-size-option"
            data-size="Medium"
            data-price="2.40"
          >
            Medium – $2.40
          </button>

          <button
            class="btn drink-size-btn drink-size-option"
            data-size="Large"
            data-price="2.60"
          >
            Large – $2.60
          </button>
        </div>

        <button id="drink-size-cancel" class="drink-size-cancel">Cancel</button>
      </div>
    </div>

    <!-- ITEM SIZE MODAL (for a la carte entrees/sides) -->
    <div id="item-size-modal" class="drink-popup-overlay" style="display: none;">
      <div class="drink-popup-modal">
        <h3 class="drink-popup-title" id="item-size-title">Select Size</h3>
        <div id="item-size-buttons" class="drink-size-options">
          <!-- Dynamically populated -->
        </div>
        <button id="item-size-cancel" class="drink-size-cancel">Cancel</button>
      </div>
    </div>
  </body>

  <script>
    // Load menu data from server and update button prices
    const menuItems = <%- JSON.stringify(menuItems || []) %>;
    
    // Update button prices and size pricing from database
    document.addEventListener('DOMContentLoaded', () => {
      console.log('Loading menu items:', menuItems.length);
      menuItems.forEach(item => {
        const buttons = document.querySelectorAll(`[data-name="${item.name}"]`);
        console.log(`Looking for buttons with name "${item.name}":`, buttons.length, 'found');
        
        if (buttons.length === 0) {
          console.warn(`No buttons found for item: ${item.name}`);
        }
        
        buttons.forEach(btn => {
          // Convert Prisma Decimal to number
          btn.dataset.price = parseFloat(item.price).toFixed(2);
          
          // Add size pricing if available
          if (item.size_pricing && item.size_pricing.length > 0) {
            const sizePricing = {};
            item.size_pricing.forEach(sp => {
              sizePricing[sp.size] = parseFloat(sp.price);
            });
            const sizePricingJson = JSON.stringify(sizePricing);
            btn.setAttribute('data-size-pricing', sizePricingJson);
            console.log(`Added size pricing to ${item.name}:`, sizePricingJson);
          }
        });
      });
      
      // Log all button names for comparison
      console.log('All button names in DOM:');
      document.querySelectorAll('[data-name]').forEach(btn => {
        console.log(`  "${btn.getAttribute('data-name')}"`);
      });
    });
    
    // Back to Navigation button
    document.getElementById("back-nav-btn")?.addEventListener("click", () => {
      window.location.href = "/";
    });

    // Logout button
    document.getElementById("logout-btn")?.addEventListener("click", () => {
      window.location.href = "/logout";
    });

    (function () {
      // ===== CONFIG =====
      let TAX_RATE = 0.0825; // Default 8.25%
      
      // Fetch tax rate from server
      fetch('/api/tax-rate')
        .then(res => res.json())
        .then(data => {
          TAX_RATE = data.rate;
          updateOrderSummary(); // Refresh display with correct tax
        })
        .catch(err => console.error('Failed to fetch tax rate:', err));

      // ===== CLOCK IN/OUT STATE =====
      let clockedInEmployee = null; // { employee_id, display_name, log_id }

      // Meal rules
      const MEAL_CONFIGS = {
        Bowl: { bases: 1, entrees: 1 },
        Plate: { bases: 1, entrees: 2 },
        "Bigger Plate": { bases: 1, entrees: 3 },
      };

      // ===== STATE =====
      let orderItems = [];
      let nextId = 1;
      let currentOrderNumber = 1;

      // meal-building state
      let activeMeal = null;
      let selectedBaseButton = null;
      let selectedEntreeButtons = [];

      // Search autocomplete state
      let currentSuggestions = [];

      // ===== DOM =====
      const orderBody = document.getElementById("order-body");
      const subtotalEl = document.getElementById("subtotal-value");
      const taxEl = document.getElementById("tax-value");
      const headerTotalEl = document.querySelector(".total-value");

      const voidLastBtn = document.getElementById("void-last-btn");
      const clearOrderBtn = document.getElementById("clear-order-btn");
      const orderButtons = document.querySelectorAll(".order-btn");

      const mealStatusEl = document.getElementById("meal-status");
      const orderNumberEl = document.getElementById("order-number");

      // ===== HELPERS =====
      function formatMoney(amount) {
        return "$" + amount.toFixed(2);
      }

      function setMealStatus(text) {
        if (!mealStatusEl) return;
        mealStatusEl.textContent = text;
      }

      function clearMealSelectionUI() {
        // remove highlight from any previously selected buttons
        document.querySelectorAll(".btn-selected").forEach((btn) => {
          btn.classList.remove("btn-selected");
          delete btn.dataset.count;
        });
        selectedBaseButton = null;
        selectedEntreeButtons = [];
      }

      function getButtonDisplayInfo(btn) {
        const name =
          btn.getAttribute("data-name") || btn.getAttribute("data-base") || "";
        const kind =
          btn.getAttribute("data-kind") ||
          (btn.classList.contains("btn-drink") ? "drink" : "item");

        let kindLabel = "";
        if (kind === "meal") kindLabel = "MEAL";
        else if (kind === "base") kindLabel = "BASE";
        else if (kind === "entree") kindLabel = "ENTRÉE";
        else if (kind === "item") kindLabel = "APP / SIDE";
        else if (kind === "drink") kindLabel = "DRINK";

        return { name, kindLabel };
      }

      // ===== DRINK LOGIC =====
      function initDrinkButtons() {
        const drinkButtons = document.querySelectorAll(".drink-btn");
        drinkButtons.forEach((btn) => {
          btn.addEventListener("click", () => {
            const drinkName = btn.getAttribute("data-base");
            const price = parseFloat(btn.getAttribute("data-price") || btn.dataset.price || 0);
            // Drinks add directly with base price (no size selection)
            addOrderLine(drinkName, price);
          });
        });
      }
      initDrinkButtons();

      // ===== ITEM SIZE MODAL (for a la carte items) =====
      const itemSizeModal = document.getElementById("item-size-modal");
      const itemSizeTitle = document.getElementById("item-size-title");
      const itemSizeButtons = document.getElementById("item-size-buttons");
      const itemSizeCancel = document.getElementById("item-size-cancel");

      function showItemSizeModal(itemName, basePrice, sizePricing) {
        itemSizeTitle.textContent = `${itemName} - Select Size`;
        itemSizeButtons.innerHTML = '';
        
        const isPremium = itemName.toLowerCase().includes('honey walnut') || 
                         itemName.toLowerCase().includes('black pepper sirloin');
        
        // Generate size buttons (small, medium, large)
        const sizes = ['small', 'medium', 'large'];
        sizes.forEach(size => {
          let price;
          if (size === 'medium') {
            price = basePrice; // Medium uses base price
          } else if (isPremium) {
            // Premium items use capitalized size keys
            const capSize = size.charAt(0).toUpperCase() + size.slice(1);
            price = sizePricing[capSize];
          } else {
            // Regular items use lowercase
            price = sizePricing[size];
          }
          
          if (price) {
            const btn = document.createElement('button');
            btn.className = 'btn drink-size-btn drink-size-option';
            const sizeLabel = size.charAt(0).toUpperCase() + size.slice(1);
            btn.textContent = `${sizeLabel} – $${parseFloat(price).toFixed(2)}`;
            btn.addEventListener('click', () => {
              const finalName = `${itemName} (${sizeLabel})`;
              addOrderLine(finalName, parseFloat(price), itemName);
              itemSizeModal.style.display = 'none';
            });
            itemSizeButtons.appendChild(btn);
          }
        });
        
        itemSizeModal.style.display = 'flex';
      }

      itemSizeCancel.addEventListener('click', () => {
        itemSizeModal.style.display = 'none';
      });

      // ===== CLOCK IN/OUT LOGIC =====
      const clockModal = document.getElementById("clock-modal");
      const clockToggleBtn = document.getElementById("clock-toggle-btn");
      const clockInSection = document.getElementById("clock-in-section");
      const clockOutSection = document.getElementById("clock-out-section");
      const clockInBtn = document.getElementById("clock-in-btn");
      const clockOutBtn = document.getElementById("clock-out-btn");
      const clockModalCancel = document.getElementById("clock-modal-cancel");
      const clockedEmployeeNameEl = document.getElementById(
        "clocked-employee-name"
      );
      const clockStatusEl = document.getElementById("clock-status");
      const currentClockedEmployeeEl = document.getElementById(
        "current-clocked-employee"
      );
      const clockInEmployeeIdInput = document.getElementById(
        "clock-in-employee-id"
      );

      function openClockModal() {
        if (clockedInEmployee) {
          // Show clock out section
          clockInSection.style.display = "none";
          clockOutSection.style.display = "block";
          currentClockedEmployeeEl.textContent = clockedInEmployee.display_name;
        } else {
          // Show clock in section
          clockInSection.style.display = "block";
          clockOutSection.style.display = "none";
          clockInEmployeeIdInput.value = "";
        }
        clockModal.style.display = "flex";
      }

      function closeClockModal() {
        clockModal.style.display = "none";
      }

      function updateClockDisplay() {
        if (clockedInEmployee) {
          clockStatusEl.style.display = "inline-flex";
          clockedEmployeeNameEl.textContent = clockedInEmployee.display_name;
          clockToggleBtn.textContent = "Clock Out";
        } else {
          clockStatusEl.style.display = "none";
          clockToggleBtn.textContent = "Clock In/Out";
        }
      }

      async function handleClockIn() {
        const employeeId = parseInt(clockInEmployeeIdInput.value);
        if (!employeeId || isNaN(employeeId)) {
          alert("Please enter a valid Employee ID");
          return;
        }

        try {
          const response = await fetch("/api/clock/in", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ employee_id: employeeId }),
          });

          const result = await response.json();
          if (result.success) {
            clockedInEmployee = {
              employee_id: result.employee_id,
              display_name: result.display_name,
            };
            updateClockDisplay();
            closeClockModal();
          } else {
            alert("Clock in failed: " + (result.error || "Unknown error"));
          }
        } catch (err) {
          console.error("Clock in error:", err);
          alert("Clock in failed. Please try again.");
        }
      }

      async function handleClockOut() {
        if (!clockedInEmployee) return;

        try {
          const response = await fetch("/api/clock/out", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({}),
          });

          const result = await response.json();
          if (result.success) {
            clockedInEmployee = null;
            updateClockDisplay();
            closeClockModal();
          } else {
            alert("Clock out failed: " + (result.error || "Unknown error"));
          }
        } catch (err) {
          console.error("Clock out error:", err);
          alert("Clock out failed. Please try again.");
        }
      }

      clockToggleBtn.addEventListener("click", openClockModal);
      clockInBtn.addEventListener("click", handleClockIn);
      clockOutBtn.addEventListener("click", handleClockOut);
      clockModalCancel.addEventListener("click", closeClockModal);
      clockModal.addEventListener("click", (e) => {
        if (e.target === clockModal) closeClockModal();
      });

      // Enter key in employee ID input triggers clock in
      clockInEmployeeIdInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") handleClockIn();
      });

      // ===== ORDER LOGIC =====

      function addOrderLine(name, price, baseName = null, options = null) {
        const existing = orderItems.find(
          (item) => item.name === name && item.price === price
        );
        if (existing) existing.quantity += 1;
        else {
          orderItems.push({
            id: nextId++,
            name,
            baseName: baseName || name,
            price,
            quantity: 1,
            options: options || undefined
          });
        }
        renderOrder();
      }

      function removeItem(id) {
        orderItems = orderItems.filter((item) => item.id !== id);
        renderOrder();
      }

      function removeLastItem() {
        if (orderItems.length === 0) return;
        orderItems.pop();
        renderOrder();
      }

      function clearOrder() {
        orderItems = [];
        activeMeal = null;
        setMealStatus("");
        clearMealSelectionUI();

        currentOrderNumber += 1;
        updateOrderNumber();

        renderOrder();
      }

      function updateOrderNumber() {
        if (orderNumberEl) {
          orderNumberEl.textContent = currentOrderNumber;
        }
      }

      function renderOrder() {
        if (!orderBody || !subtotalEl || !taxEl || !headerTotalEl) return;

        orderBody.innerHTML = "";
        let subtotal = 0;

        orderItems.forEach((item) => {
          const row = document.createElement("tr");

          const lineTotal = item.price * item.quantity;
          subtotal += lineTotal;

          const itemCell = document.createElement("td");
          itemCell.textContent = item.name;

          const qtyCell = document.createElement("td");
          qtyCell.textContent = String(item.quantity);

          const priceCell = document.createElement("td");
          priceCell.textContent = formatMoney(lineTotal);

          const deleteCell = document.createElement("td");
          deleteCell.style.textAlign = "left";

          const deleteBtn = document.createElement("button");
          deleteBtn.textContent = "Void";
          deleteBtn.className = "btn btn-void";
          deleteBtn.style.fontSize = "0.7rem";
          deleteBtn.style.padding = "0.3rem 0.6rem";

          deleteBtn.addEventListener("click", () => removeItem(item.id));
          deleteCell.appendChild(deleteBtn);

          row.appendChild(itemCell);
          row.appendChild(qtyCell);
          row.appendChild(priceCell);
          row.appendChild(deleteCell);

          orderBody.appendChild(row);
        });

        const tax = subtotal * TAX_RATE;
        const total = subtotal + tax;

        subtotalEl.textContent = formatMoney(subtotal);
        taxEl.textContent = formatMoney(tax);
        headerTotalEl.textContent = formatMoney(total);
      }

      // ===== MEAL BUILDING =====
      function startMealBuild(mealName, mealPrice) {
        const cfg = MEAL_CONFIGS[mealName];
        if (!cfg) {
          // if meal not recognized, just add as normal item
          addOrderLine(mealName, mealPrice);
          return;
        }

        // reset any previous selection UI
        clearMealSelectionUI();

        activeMeal = {
          mealName,
          mealPrice,
          basesNeeded: cfg.bases,
          entreesNeeded: cfg.entrees,
          baseChoice: null,
          entreeChoices: [],
        };

        setMealStatus(
          `Building ${mealName}: choose ${cfg.bases} base & ${cfg.entrees} entree(s)`
        );
      }

      function chooseBase(baseName, btn) {
        if (!activeMeal) return;
        
        const cfg = MEAL_CONFIGS[activeMeal.mealName];
        const allowHalf = cfg && (activeMeal.mealName === 'Plate' || activeMeal.mealName === 'Bigger Plate');
        
        if (!activeMeal.sideCounts) {
          activeMeal.sideCounts = {};
        }
        
        if (allowHalf) {
          // Toggle between 0 -> 0.5 -> 1 -> 0
          const current = activeMeal.sideCounts[baseName] || 0;
          if (current === 0) {
            activeMeal.sideCounts[baseName] = 0.5;
            btn.classList.add("btn-selected");
          } else if (current === 0.5) {
            activeMeal.sideCounts[baseName] = 1;
          } else {
            activeMeal.sideCounts[baseName] = 0;
            btn.classList.remove("btn-selected");
          }
          
          // Check if total equals 1
          const total = Object.values(activeMeal.sideCounts).reduce((s, v) => s + v, 0);
          if (Math.abs(total - 1) < 0.001) {
            activeMeal.baseChoice = Object.entries(activeMeal.sideCounts)
              .filter(([_, v]) => v > 0)
              .map(([name, v]) => v === 1 ? name : `${name} (Half)`)
              .join(' + ');
            setMealStatus(`Building ${activeMeal.mealName}: choose ${activeMeal.entreesNeeded} entree(s)`);
            tryCompleteMeal();
          } else {
            activeMeal.baseChoice = null;
            setMealStatus(`Building ${activeMeal.mealName}: sides ${total.toFixed(1)}/1, choose ${activeMeal.entreesNeeded} entrees`);
          }
        } else {
          // Bowl: single full side only
          if (selectedBaseButton) {
            selectedBaseButton.classList.remove("btn-selected");
          }
          selectedBaseButton = btn;
          btn.classList.add("btn-selected");
          activeMeal.baseChoice = baseName;
          setMealStatus(`Building ${activeMeal.mealName}: choose ${activeMeal.entreesNeeded} entree(s)`);
          tryCompleteMeal();
        }
      }

      function chooseEntree(entreeName, btn) {
        if (!activeMeal) return;
        
        // Initialize entree counts if needed
        if (!activeMeal.entreeCounts) {
          activeMeal.entreeCounts = {};
        }
        
        // Increment count for this entree
        const currentCount = activeMeal.entreeCounts[entreeName] || 0;
        activeMeal.entreeCounts[entreeName] = currentCount + 1;
        
        // Add visual feedback
        if (!btn.dataset.count) {
          btn.classList.add("btn-selected");
        }
        btn.dataset.count = activeMeal.entreeCounts[entreeName];
        
        // Calculate total entrees selected
        const totalEntrees = Object.values(activeMeal.entreeCounts).reduce((sum, c) => sum + c, 0);
        
        // Update entree choices array
        activeMeal.entreeChoices = [];
        Object.entries(activeMeal.entreeCounts).forEach(([name, count]) => {
          for (let i = 0; i < count; i++) {
            activeMeal.entreeChoices.push(name);
          }
        });
        
        const remaining = activeMeal.entreesNeeded - totalEntrees;
        if (remaining > 0) {
          setMealStatus(`Building ${activeMeal.mealName}: ${remaining} entree(s) left`);
        } else if (remaining === 0) {
          // Check if base is also selected before saying complete
          if (activeMeal.baseChoice) {
            setMealStatus(`Building ${activeMeal.mealName}: complete!`);
          } else {
            setMealStatus(`Building ${activeMeal.mealName}: now choose base`);
          }
          tryCompleteMeal();
        } else {
          // Too many - remove last one
          activeMeal.entreeCounts[entreeName]--;
          if (activeMeal.entreeCounts[entreeName] === 0) {
            delete activeMeal.entreeCounts[entreeName];
            btn.classList.remove("btn-selected");
            delete btn.dataset.count;
          } else {
            btn.dataset.count = activeMeal.entreeCounts[entreeName];
          }
        }
      }

      function tryCompleteMeal() {
        if (!activeMeal) return;

        const baseDone = !!activeMeal.baseChoice;
        const entreesDone =
          activeMeal.entreeChoices.length === activeMeal.entreesNeeded;

        if (baseDone && entreesDone) {
          const baseText = activeMeal.baseChoice;
          const entreeText = activeMeal.entreeChoices.join(", ");

          const lineName = `${activeMeal.mealName} (${baseText}; ${entreeText})`;

          // Build options array for backend (sides and entrees)
          const options = [];
          
          // Add base/side options
          if (activeMeal.sideCounts) {
            Object.entries(activeMeal.sideCounts).forEach(([name, count]) => {
              if (count > 0) {
                options.push({ name, qty: count });
              }
            });
          } else if (activeMeal.baseChoice) {
            // For Bowl (single base without sideCounts)
            options.push({ name: activeMeal.baseChoice, qty: 1 });
          }
          
          // Add entree options
          if (activeMeal.entreeCounts) {
            Object.entries(activeMeal.entreeCounts).forEach(([name, count]) => {
              if (count > 0) {
                options.push({ name, qty: count });
              }
            });
          } else {
            // Fallback to entreeChoices array
            activeMeal.entreeChoices.forEach(name => {
              options.push({ name, qty: 1 });
            });
          }

          addOrderLine(lineName, activeMeal.mealPrice, activeMeal.mealName, options);

          activeMeal = null;
          setMealStatus("");
          clearMealSelectionUI();
        }
      }

      // ===== BUTTON HANDLERS =====
      function handleButtonClick(btn) {
        const kind = btn.getAttribute("data-kind"); // meal | base | entree | item
        const name = btn.getAttribute("data-name");
        const priceAttr = btn.getAttribute("data-price");

        if (!name || !priceAttr) return;
        const price = parseFloat(priceAttr);
        if (isNaN(price)) return;

        // If currently building a meal:
        if (activeMeal) {
          if (kind === "meal") {
            // starting a new meal overwrites previous incomplete meal
            startMealBuild(name, price);
            return;
          }

          if (kind === "base") {
            chooseBase(name, btn);
            return;
          }

          if (kind === "entree") {
            chooseEntree(name, btn);
            return;
          }

          // kind === "item" while building a meal:
          // allow a-la-carte add without interrupting meal
          addOrderLine(name, price);
          return;
        }

        // Not building a meal:
        if (kind === "meal") {
          startMealBuild(name, price);
        } else if (kind === "base" || kind === "entree") {
          // For bases and entrees ordered a la carte, check for size options
          const sizePricingStr = btn.getAttribute('data-size-pricing');
          console.log('A la carte item clicked:', name, 'sizePricing:', sizePricingStr);
          if (sizePricingStr) {
            try {
              const sizePricing = JSON.parse(sizePricingStr);
              if (sizePricing && Object.keys(sizePricing).length > 0) {
                console.log('Showing size modal for:', name, sizePricing);
                showItemSizeModal(name, price, sizePricing);
                return;
              }
            } catch (e) {
              console.error('Error parsing size pricing:', e);
            }
          }
          // No size pricing, add directly
          addOrderLine(name, price);
        } else {
          // Regular items without sizes
          addOrderLine(name, price);
        }
      }

      function initSearchAutocomplete() {
        const searchInput = document.querySelector(".search-input");
        const suggestionBox = document.getElementById("search-suggestions");
        if (!searchInput || !suggestionBox) return;

        function hideSuggestions() {
          suggestionBox.classList.remove("visible");
          suggestionBox.innerHTML = "";
          currentSuggestions = [];
        }

        function showSuggestions(list) {
          suggestionBox.innerHTML = "";
          if (!list.length) {
            hideSuggestions();
            return;
          }

          list.forEach((entry) => {
            const div = document.createElement("div");
            div.className = "search-suggestion-item";

            const nameSpan = document.createElement("span");
            nameSpan.textContent = entry.label;

            const kindSpan = document.createElement("span");
            kindSpan.className = "search-suggestion-item-kind";
            kindSpan.textContent = entry.kindLabel;

            div.appendChild(nameSpan);
            div.appendChild(kindSpan);

            div.addEventListener("click", () => {
              entry.button.click(); // trigger the actual POS button
              searchInput.value = "";
              hideSuggestions();
            });

            suggestionBox.appendChild(div);
          });

          suggestionBox.classList.add("visible");
        }

        function updateSuggestions() {
          const query = searchInput.value.trim().toLowerCase();
          if (query.length < 2) {
            hideSuggestions();
            return;
          }

          const buttons = document.querySelectorAll(".order-btn, .drink-btn");
          const suggestions = [];

          buttons.forEach((btn) => {
            const { name, kindLabel } = getButtonDisplayInfo(btn);
            const normalized = name.toLowerCase();
            if (!normalized || !normalized.includes(query)) return;

            suggestions.push({
              label: name,
              kindLabel,
              button: btn,
            });
          });

          // Limit to first 8 matches
          currentSuggestions = suggestions.slice(0, 8);
          showSuggestions(currentSuggestions);
        }

        // Input change updates dropdown
        searchInput.addEventListener("input", updateSuggestions);

        // Keyboard behavior: Enter selects first, Escape closes
        searchInput.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            if (currentSuggestions.length > 0) {
              currentSuggestions[0].button.click();
              searchInput.value = "";
              hideSuggestions();
            } else {
              hideSuggestions();
            }
            e.preventDefault();
          } else if (e.key === "Escape") {
            hideSuggestions();
          }
        });

        // Click outside closes dropdown
        document.addEventListener("click", (e) => {
          if (!suggestionBox.contains(e.target) && e.target !== searchInput) {
            hideSuggestions();
          }
        });
      }

      // ===== CHECKOUT / PAY =====
      async function processPayment() {
        if (orderItems.length === 0) {
          alert("Cart is empty. Please add items before paying.");
          return;
        }

        // Convert cashier orderItems to the format expected by backend
        const cartForBackend = orderItems.map((item) => {
          const cartItem = {
            name: item.name,
            baseName: item.baseName || item.name,
            price: item.price,
            quantity: item.quantity,
          };
          
          // Include options array if present (for meals)
          if (item.options && Array.isArray(item.options)) {
            cartItem.options = item.options;
          }
          
          return cartItem;
        });

        try {
          const response = await fetch("/api/cashier/checkout", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              cart: cartForBackend,
              paymentMethod: "card",
              dineOption: "dine_in",
              clockedInEmployeeId: clockedInEmployee
                ? clockedInEmployee.employee_id
                : null,
            }),
          });

          const result = await response.json();

          if (result.success) {
            alert(`Order #${result.order_id} completed successfully!`);
            clearOrder();
          } else {
            alert("Payment failed: " + (result.error || "Unknown error"));
          }
        } catch (err) {
          console.error("Payment error:", err);
          alert("Payment failed. Please try again.");
        }
      }

      function init() {
        orderButtons.forEach((btn) => {
          btn.addEventListener("click", () => handleButtonClick(btn));
        });

        voidLastBtn && voidLastBtn.addEventListener("click", removeLastItem);
        clearOrderBtn && clearOrderBtn.addEventListener("click", clearOrder);

        // Hook up Pay button
        const payBtn = document.querySelector(".btn-pay");
        if (payBtn) {
          payBtn.addEventListener("click", processPayment);
        }

        // hook up search autocomplete
        initSearchAutocomplete();

        renderOrder();
      }

      document.addEventListener("DOMContentLoaded", init);
    })();
  </script>
  <script>
    if (window.location.pathname.includes("cashier")) {
      const popup = document.getElementById("staff-call-popup");
      const dismissBtn = document.getElementById("staff-call-dismiss");

      // Start hidden
      popup.style.display = "none";

      const eventSource = new EventSource("/api/call-staff/stream");

      eventSource.onmessage = () => {
        popup.style.display = "flex"; // show it

        clearTimeout(window.staffCallTimeout);
        window.staffCallTimeout = setTimeout(() => {
          popup.style.display = "none";
        }, 60000); // auto-hide after 60 sec
      };

      // Dismiss button works instantly now
      dismissBtn.onclick = () => {
        popup.style.display = "none";
        clearTimeout(window.staffCallTimeout);
      };

      // Click overlay or press Escape also dismisses
      popup.onclick = (e) => {
        if (e.target === popup) dismissBtn.click();
      };
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && popup.style.display === "flex")
          dismissBtn.click();
      });
    }
  </script>
</html>
