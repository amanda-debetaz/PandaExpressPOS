generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model category {
  category_id   Int         @id @default(autoincrement())
  name          String      @unique
  display_order Int         @default(0)
  menu_item     menu_item[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model clock_log {
  log_id      Int       @id @default(autoincrement())
  employee_id Int?
  clock_in    DateTime? @db.Timestamp(6)
  clock_out   DateTime? @db.Timestamp(6)
  status      String?   @db.VarChar(10)
  employee    employee? @relation(fields: [employee_id], references: [employee_id], onDelete: NoAction, onUpdate: NoAction)
}

model employee {
  employee_id      Int                @id @default(autoincrement())
  name             String
  role             employee_role_enum
  password_hash    String
  is_active        Boolean            @default(true)
  clock_log        clock_log[]
  order            order[]
  shift_assignment shift_assignment[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model inventory {
  ingredient_id     Int      @id @default(autoincrement())
  name              String   @unique
  unit              String
  servings_per_unit Int
  par_level         Int      @default(0)
  reorder_point     Int      @default(0)
  cost_per_unit     Decimal  @db.Decimal(10, 2)
  lead_time_days    Int      @default(0)
  is_perishable     Boolean  @default(false)
  shelf_life_days   Int      @default(0)
  allergen_info     String   @default("")
  is_active         Boolean  @default(true)
  current_quantity  Int?     @default(0)
  recipe            recipe[]
}

model manager {
  manager_id     Int              @id @default(autoincrement())
  name           String
  shift_schedule shift_schedule[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model menu_item {
  menu_item_id           Int                      @id @default(autoincrement())
  name                   String                   @unique
  price                  Decimal                  @db.Decimal(10, 2)
  category_id            Int
  is_active              Boolean                  @default(true)
  category               category                 @relation(fields: [category_id], references: [category_id], onUpdate: NoAction)
  menu_item_option_group menu_item_option_group[]
  option                 option[]
  order_item             order_item[]
  recipe                 recipe[]

  @@index([category_id], map: "idx_menu_item_category")
}

model menu_item_option_group {
  menu_item_id    Int
  option_group_id Int
  menu_item       menu_item    @relation(fields: [menu_item_id], references: [menu_item_id], onDelete: Cascade, onUpdate: NoAction)
  option_group    option_group @relation(fields: [option_group_id], references: [option_group_id], onDelete: Cascade, onUpdate: NoAction)

  @@id([menu_item_id, option_group_id])
}

model option {
  option_id         Int                 @id @default(autoincrement())
  option_group_id   Int
  name              String
  price_delta       Decimal             @default(0) @db.Decimal(10, 2)
  menu_item_id      Int?
  menu_item         menu_item?          @relation(fields: [menu_item_id], references: [menu_item_id], onDelete: Cascade, onUpdate: NoAction)
  option_group      option_group        @relation(fields: [option_group_id], references: [option_group_id], onDelete: Cascade, onUpdate: NoAction)
  order_item_option order_item_option[]

  @@index([option_group_id], map: "idx_option_group")
  @@index([menu_item_id], map: "idx_option_item")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model option_group {
  option_group_id        Int                      @id @default(autoincrement())
  name                   String                   @unique
  min_select             Int                      @default(0)
  max_select             Int                      @default(1)
  menu_item_option_group menu_item_option_group[]
  option                 option[]
}

model order {
  order_id     Int              @id @default(autoincrement())
  dine_option  dine_option_enum @default(takeout)
  employee_id  Int
  notes        String?
  created_at   DateTime         @default(now()) @db.Timestamptz(6)
  status       kitchen_status   @default(queued)
  completed_at DateTime?        @db.Timestamptz(6)
  employee     employee         @relation(fields: [employee_id], references: [employee_id], onUpdate: NoAction)
  order_item   order_item[]
  payment      payment[]

  @@index([status, created_at], map: "order_status_created_idx")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model order_item {
  order_item_id     Int                 @id @default(autoincrement())
  order_id          Int
  menu_item_id      Int
  qty               Int                 @default(1)
  unit_price        Decimal             @db.Decimal(10, 2)
  discount_amount   Decimal             @default(0) @db.Decimal(10, 2)
  tax_amount        Decimal             @default(0) @db.Decimal(10, 2)
  menu_item         menu_item           @relation(fields: [menu_item_id], references: [menu_item_id], onUpdate: NoAction)
  order             order               @relation(fields: [order_id], references: [order_id], onDelete: Cascade, onUpdate: NoAction)
  order_item_option order_item_option[]

  @@index([order_id], map: "idx_order_item_order")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model order_item_option {
  order_item_id Int
  option_id     Int
  qty           Int        @default(1)
  option        option     @relation(fields: [option_id], references: [option_id], onUpdate: NoAction)
  order_item    order_item @relation(fields: [order_item_id], references: [order_item_id], onDelete: Cascade, onUpdate: NoAction)

  @@id([order_item_id, option_id])
  @@index([option_id], map: "idx_oio_option")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model payment {
  payment_id Int                 @id @default(autoincrement())
  order_id   Int
  method     payment_method_enum
  amount     Decimal             @db.Decimal(10, 2)
  auth_ref   String?
  created_at DateTime            @default(now()) @db.Timestamptz(6)
  paid_at    DateTime?           @db.Timestamptz(6)
  order      order               @relation(fields: [order_id], references: [order_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([order_id], map: "idx_payment_order")
}

model pricing_settings {
  key   String  @id
  value Decimal @db.Decimal(10, 2)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model recipe {
  menu_item_id  Int
  ingredient_id Int
  qty_per_item  Decimal   @db.Decimal(12, 3)
  qty_unit      String
  inventory     inventory @relation(fields: [ingredient_id], references: [ingredient_id], onUpdate: NoAction)
  menu_item     menu_item @relation(fields: [menu_item_id], references: [menu_item_id], onDelete: Cascade, onUpdate: NoAction)

  @@id([menu_item_id, ingredient_id])
  @@index([ingredient_id], map: "idx_recipe_ing")
}

model shift_assignment {
  schedule_id    Int
  employee_id    Int
  role           employee_role_enum
  employee       employee           @relation(fields: [employee_id], references: [employee_id], onUpdate: NoAction)
  shift_schedule shift_schedule     @relation(fields: [schedule_id], references: [schedule_id], onDelete: Cascade, onUpdate: NoAction)

  @@id([schedule_id, employee_id])
}

model shift_schedule {
  schedule_id      Int                @id @default(autoincrement())
  manager_id       Int
  shift_date       DateTime           @db.Date
  start_time       DateTime           @db.Time(6)
  end_time         DateTime           @db.Time(6)
  shift_assignment shift_assignment[]
  manager          manager            @relation(fields: [manager_id], references: [manager_id], onUpdate: NoAction)
}

model store_statistics {
  stats_date   DateTime @id @db.Date
  total_orders Int      @default(0)
  subtotal     Decimal  @default(0) @db.Decimal(12, 2)
  discounts    Decimal  @default(0) @db.Decimal(12, 2)
  tax          Decimal  @default(0) @db.Decimal(12, 2)
  revenue      Decimal  @default(0) @db.Decimal(12, 2)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model tax_rate {
  name String  @id
  rate Decimal @db.Decimal(6, 4)
}

model team_members {
  student_name     String    @id
  section          Int?
  favorite_movie   String?
  favorite_holiday DateTime? @db.Date
}

enum dine_option_enum {
  dine_in
  takeout
}

enum employee_role_enum {
  manager
  cook
  cashier
}

enum payment_method_enum {
  cash
  card
  giftcard
  dining_dollars
  meal_swipe
}

enum kitchen_status {
  queued
  prepping
  done
}
